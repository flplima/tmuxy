services:
  tmuxy-dev:
    build: .
    image: tmuxy-dev
    container_name: tmuxy-dev
    network_mode: host
    init: true          # Proper init process to reap zombie processes
    pids_limit: 50000   # Safety buffer for process count
    stdin_open: true
    tty: true
    user: claude
    working_dir: /workspace
    volumes:
      # Project workspace
      - .:/workspace
      # Container config files
      - ./docker:/home/claude/docker:ro
      # Dotfiles scripts (tmux-run, etc.)
      - ~/dotfiles/scripts:/home/claude/dotfiles/scripts:ro
      # pptr-cli (mounted at same path as host for script compatibility)
      - ~/projects/workbench/pptr-cli:/home/felipe/projects/workbench/pptr-cli:ro
      # Claude config (auth and settings)
      - ~/.claude:/home/claude/.claude
      # SSH keys for git
      - ~/.ssh:/home/claude/.ssh:ro
      # GitHub CLI auth
      - ~/.config/gh:/home/claude/.config/gh:ro
      # Cargo cache for faster builds
      - tmuxy-cargo-registry:/usr/local/cargo/registry
      - tmuxy-cargo-git:/usr/local/cargo/git
    environment:
      - CHROME_CDP_URL=http://localhost:9222
      - TMUX_SESSION=dev
    security_opt:
      - no-new-privileges:true
    shm_size: 1g
    mem_limit: 6g
    command: bash -c "npm start && claude --dangerously-skip-permissions"

volumes:
  tmuxy-cargo-registry:
  tmuxy-cargo-git:
