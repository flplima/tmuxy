#!/bin/sh
set -e

# --- JS/TS ---
echo "Formatting (Prettier)..."
npm run format -w tmuxy-ui

echo "Linting (ESLint --fix)..."
npm run lint:fix -w tmuxy-ui

# Re-stage any files auto-fixed by lint/format
git add -u packages/tmuxy-ui/src

echo "Linting E2E tests (no skipped tests)..."
npm run lint:tests

echo "Running unit tests..."
npm test -- --run

# --- Rust ---
echo "Formatting Rust (cargo fmt)..."
cargo fmt -p tmuxy-core -p tmuxy-server

# Re-stage any files formatted by cargo fmt
git add -u packages/tmuxy-core packages/tmuxy-server

echo "Checking Rust (cargo clippy)..."
mkdir -p packages/tmuxy-ui/dist
cargo clippy -p tmuxy-core -p tmuxy-server
