# Tmuxy Application Configuration
# This config is used by the tmuxy web application when managing tmux sessions
# Includes sane defaults commonly used by developers

# ============================================
# Tmuxy Command Aliases
# ============================================

# Pane group operations (run-shell scripts with tmux format strings)
set -s command-alias[100] 'tmuxy-pane-group-add=run-shell "scripts/tmuxy/pane-group-add.sh #{pane_id} #{pane_width} #{pane_height}"'
set -s command-alias[101] 'tmuxy-pane-group-prev=run-shell "scripts/tmuxy/pane-group-prev.sh #{pane_id}"'
set -s command-alias[102] 'tmuxy-pane-group-next=run-shell "scripts/tmuxy/pane-group-next.sh #{pane_id}"'

# Unified navigation (group → splits → tabs)
set -s command-alias[110] 'tmuxy-nav-left=run-shell "bash scripts/tmuxy/nav.sh left #{pane_id}"'
set -s command-alias[111] 'tmuxy-nav-right=run-shell "bash scripts/tmuxy/nav.sh right #{pane_id}"'
set -s command-alias[112] 'tmuxy-nav-up=run-shell "bash scripts/tmuxy/nav.sh up #{pane_id}"'
set -s command-alias[113] 'tmuxy-nav-down=run-shell "bash scripts/tmuxy/nav.sh down #{pane_id}"'
set -s command-alias[114] 'tmuxy-nav-next=run-shell "bash scripts/tmuxy/nav.sh next #{pane_id}"'
set -s command-alias[115] 'tmuxy-nav-prev=run-shell "bash scripts/tmuxy/nav.sh prev #{pane_id}"'

# ============================================
# Terminal Settings
# ============================================

# Use 256 colors with true color support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc,xterm-256color:Tc"

# No delay for escape sequences (important for vim/neovim)
set -sg escape-time 0

# Faster key repeat
set -g repeat-time 300

# Large scrollback history
set -g history-limit 100000

# Focus events for applications like vim
set -g focus-events on

# Allow passthrough for OSC sequences (hyperlinks, images, etc.)
set -g allow-passthrough on

# Allow applications to set the pane title (OSC 0/2)
set -g allow-rename on
set -g set-titles on

# ============================================
# Prefix Key: Ctrl+a (screen-style)
# ============================================

unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Double Ctrl+a sends literal Ctrl+a to application
bind a send-prefix

# ============================================
# Mouse Support
# ============================================

set -g mouse on

# ============================================
# Window & Pane Numbering
# ============================================

# Start windows and panes at 1 (easier keyboard access)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# ============================================
# Vi Mode & Copy Mode
# ============================================

# Vi mode for copy mode and status line editing
setw -g mode-keys vi
set -g status-keys vi

# Vi-style copy mode bindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi V send-keys -X select-line
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi Escape send-keys -X cancel
bind-key -T copy-mode-vi q send-keys -X cancel

# Prevent auto-copy and exit on mouse drag release (keeps selection visible)
unbind -T copy-mode-vi MouseDragEnd1Pane

# Search in copy mode (vi-style)
bind-key -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind-key -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""

# ============================================
# Intuitive Split Bindings
# ============================================

# Split with - and | (opens in current directory)
bind - split-window -v -c "#{pane_current_path}"
bind | split-window -h -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"

# Also bind " and % to use current path
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# New window in current directory
bind c new-window -c "#{pane_current_path}"

# ============================================
# Pane Navigation (Unified: group → splits → tabs)
# ============================================

# Ctrl+hjkl - unified navigation without prefix
bind -n C-h tmuxy-nav-left
bind -n C-j tmuxy-nav-down
bind -n C-k tmuxy-nav-up
bind -n C-l tmuxy-nav-right

# Ctrl+arrow keys - unified navigation without prefix
bind -n C-Left tmuxy-nav-left
bind -n C-Right tmuxy-nav-right
bind -n C-Up tmuxy-nav-up
bind -n C-Down tmuxy-nav-down

# ============================================
# Pane Resizing
# ============================================

# Prefix + HJKL for resizing panes
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Prefix + arrow keys for fine-grained resizing
bind -r Left resize-pane -L 2
bind -r Down resize-pane -D 2
bind -r Up resize-pane -U 2
bind -r Right resize-pane -R 2

# ============================================
# Window Navigation
# ============================================

# Alt+number to switch windows (without prefix)
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# Shift+arrow to switch windows (direct, no group traversal)
bind -n S-Left previous-window
bind -n S-Right next-window

# ============================================
# Useful Shortcuts
# ============================================

# Reload config
bind r source-file ~/.tmuxy.conf \; display "Config reloaded!"

# Toggle synchronize-panes (type in all panes)
bind S setw synchronize-panes

# Add pane to group (tmuxy tabs)
bind = tmuxy-pane-group-add

# Quick pane swap
bind > swap-pane -D
bind < swap-pane -U

# Zoom pane (already default: prefix + z)
# Break pane to new window (already default: prefix + !)
# Join pane from another window
bind j choose-window "join-pane -h -s '%%'"

# ============================================
# Activity Monitoring
# ============================================

setw -g monitor-activity on
set -g visual-activity off

# ============================================
# Status Bar (Tmuxy manages the UI status)
# ============================================

set -g status on
set -g status-interval 1
set -g status-style 'bg=green,fg=black'
set -g status-left '#[bold][#S] '
set -g status-left-length 30
set -g status-right '#(whoami)@#H'
set -g status-right-length 50

# Window list hidden - managed by tmuxy UI
setw -g window-status-format ''
setw -g window-status-current-format ''

# ============================================
# Pane Appearance
# ============================================

# Pane borders
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Pane header (managed by tmux, shown in border)
set -g pane-border-status top
set -g pane-border-format ' #{pane_id} #{pane_current_command} (#{pane_width}x#{pane_height}) '

# ============================================
# Window Settings
# ============================================

# Automatic window rename based on running command
setw -g automatic-rename on
setw -g automatic-rename-format '#{b:pane_current_path}'

# Disable aggressive-resize - tmuxy web server manages sizing
setw -g aggressive-resize off

# Manual window sizing - only changed by resize-window commands from the web UI
set -g window-size manual
