# Tmuxy Application Configuration
# This config is used by the tmuxy web application when managing tmux sessions

# Use 256 colors with true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable mouse support (important for web UI interaction)
set -g mouse on

# Start windows and panes at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Large scrollback for capturing output
set -g history-limit 100000

# No delay for escape sequences (important for responsive UI)
set -sg escape-time 0

# Faster key repeat
set -g repeat-time 300

# Focus events for applications
set -g focus-events on

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Status bar - tmux default colors (green bg, dark text)
set -g status on
set -g status-interval 1
set -g status-style 'bg=green,fg=black'
set -g status-left '#[bold][#S] '
set -g status-left-length 30
set -g status-right '#(whoami)@#H'
set -g status-right-length 50

# Window list hidden - managed by tmuxy UI
setw -g window-status-format ''
setw -g window-status-current-format ''

# Pane borders with better visibility
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Pane header showing: pane_id title (process cols x rows)
set -g pane-border-status top
set -g pane-border-format ' #{pane_id} #{pane_title} (#{pane_current_command} #{pane_width}x#{pane_height}) '

# Prefix key: Ctrl+a (consistent with dev config)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Allow passthrough for OSC sequences (hyperlinks, images, etc.)
set -g allow-passthrough on

# Automatic window rename based on running command
setw -g automatic-rename on
setw -g automatic-rename-format '#{b:pane_current_path}'

# Disable aggressive-resize - we control sizing via the web server
# which computes minimum across all connected clients
setw -g aggressive-resize off

# Use smallest client's size for proper multi-client support
# (window-size manual crashes the server when combined with control mode)
# (window-size latest causes flip-flop when clients have different sizes)
set -g window-size smallest

# Pane navigation with Ctrl+hjkl (vim-style) - navigate between panes in window
bind -n C-h select-pane -L
bind -n C-j select-pane -D
bind -n C-k select-pane -U
bind -n C-l select-pane -R

# Pane navigation with Ctrl+arrow keys
bind -n C-Left select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up select-pane -U
bind -n C-Down select-pane -D

# Alt+hjkl - In tmuxy, navigates pane group tabs (handled by the app)
# When no group is active, falls back to pane navigation
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Intuitive split bindings (prefix + - and prefix + |)
bind - split-window -v    # Horizontal split (pane below)
bind | split-window -h    # Vertical split (pane right)

# Vi mode for copy mode (required for keyboard-driven copy/paste tests)
setw -g mode-keys vi

# Vi-style copy mode bindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi Escape send-keys -X cancel

# Search in copy mode
bind-key -T copy-mode-vi / command-prompt -i -p "search down" "send -X search-forward-incremental \"%%%\""
bind-key -T copy-mode-vi ? command-prompt -i -p "search up" "send -X search-backward-incremental \"%%%\""
